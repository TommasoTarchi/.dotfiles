#!/bin/bash


# produces a YAML file (environment.yml) saving the state of the given
# conda environment
#
# the produced file can be used to generate a new environment with the
# configuration through 'conda env create -f environment.yml'


get_env_name() {
  read -r -p "No conda environment name supplied, please insert one: " ENV_NAME
}


# get name of environment to be exported
if [ -z "$1" ]; then
  get_env_name
else
  ENV_NAME=$1
fi


# export conda environment to YAML
echo "Exporting conda environment..."
conda env export --name "$ENV_NAME" --no-builds --file temp.yml

# remove environment name and prefix
echo "Formatting YAML file..."
sed -i '1s/^name: .*/name: <your_env_name>/' temp.yml
grep -v "^prefix:" temp.yml > environment.yml
rm temp.yml


echo "YAML file has been generated successfully."
